<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Teste de Temperamentos · Padonna</title>
  <style>
    :root { --bg:#f7f7f8; --card:#ffffff; --ink:#111; --muted:#666; --border:#e6e6e8; --brand:#193e51;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial,"Noto Sans",sans-serif;background:var(--bg);color:var(--ink)}
    .wrap{max-width:960px;margin:0 auto;padding:24px}
    .card{background:var(--card);border:1px solid var(--border);border-radius:18px;box-shadow:0 2px 10px rgba(0,0,0,.04)}
    header{margin-bottom:16px;display:flex;align-items:center;gap:12px}
    h1{font-size:28px;margin:0 0 6px}
    .brand{height:40px;width:auto}
    p.small{color:var(--muted);font-size:13px;margin:4px 0}
    .row{display:flex;gap:12px;align-items:center}
    .input{flex:1;border:1px solid var(--border);border-radius:12px;padding:12px 14px;font-size:14px}
    .progress{height:8px;background:#e9e9ec;border-radius:999px;overflow:hidden}
    .progress>i{display:block;height:100%;background:var(--brand);width:0%}
    ol.qs{list-style:decimal inside;margin:0;padding:0}
    .q{padding:16px;border-top:1px solid var(--border)}
    .q:first-child{border-top:0;border-top-left-radius:18px;border-top-right-radius:18px}
    .q:last-child{border-bottom-left-radius:18px;border-bottom-right-radius:18px}
    .qhead{display:flex;gap:12px;justify-content:space-between;align-items:flex-start}
    .pill{border:1px solid var(--border);background:#fafafa;border-radius:999px;padding:4px 8px;font-size:12px;color:#333}
    .likert{display:grid;grid-template-columns:repeat(5,minmax(90px,1fr));gap:8px;margin-top:10px}
    .opt{border:1px solid var(--border);border-radius:12px;padding:10px;text-align:center;cursor:pointer;user-select:none}
    .opt[data-active="1"]{border-color:var(--brand);box-shadow:inset 0 0 0 1px var(--brand)}
    .opt b{display:block;font-size:14px}
    .opt span{display:block;font-size:11px;color:var(--muted);margin-top:2px;line-height:1.1}
    .actions{display:flex;flex-wrap:wrap;gap:10px;margin-top:14px}
    button{border:1px solid var(--border);background:#fff;border-radius:12px;padding:10px 14px;font-weight:600;cursor:pointer}
    .primary{background:var(--brand);color:#fff;border-color:var(--brand)}
    .grid{display:grid;gap:12px}
    .results .bar{height:10px;background:#eee;border-radius:999px;overflow:hidden}
    .results .bar>i{display:block;height:100%}
    .tone-SANG{background:#fde68a}
    .tone-COL{background:#fca5a5}
    .tone-MEL{background:#bfdbfe}
    .tone-FLEU{background:#bbf7d0}
    .muted{color:var(--muted)}
    table{width:100%;border-collapse:collapse}
    th, td{padding:8px;border-bottom:1px solid #f0f0f2;text-align:left;font-size:13px}
    @media (max-width:720px){.likert{grid-template-columns:1fr 1fr;}}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <img id="logo" class="brand" alt="Padonna" src="data:image/jpeg;base64,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" />
      <div>
        <h1>Teste de Temperamentos</h1>
        <p class="small">Responda cada afirmação de <b>1 a 5</b>: 1 = Nunca · 2 = Raramente · 3 = Às vezes · 4 = Frequentemente · 5 = Sempre</p>
      </div>
    </header>

    <section class="card" style="padding:16px 16px 6px">
      <div class="row" style="margin-bottom:10px">
        <label class="small" for="candidate" style="min-width:90px">Candidato</label>
        <input id="candidate" class="input" placeholder="Nome completo" />
      </div>
      <div class="row" style="margin-bottom:12px">
        <div style="flex:1">
          <div class="row" style="justify-content:space-between;margin-bottom:6px">
            <span class="small">Progresso</span>
            <span id="pct" class="small">0%</span>
          </div>
          <div class="progress"><i id="bar"></i></div>
        </div>
      </div>
    </section>

    <section id="quiz" class="card" style="margin-top:12px">
      <ol id="qList" class="qs"></ol>
    </section>

    <section class="actions">
      <button class="primary" id="see">Ver resultado</button>
      <button id="save">Enviar & Registrar</button>
      <button id="clear">Limpar respostas</button>
      <button id="print">Imprimir</button>
    </section>

    <section id="result" class="card results" style="display:none;padding:16px;margin-top:12px"></section>
    <section id="admin" class="card" style="display:none;padding:16px;margin-top:12px"></section>

    <p class="small muted" style="margin-top:16px">Baseado na teoria clássica dos quatro temperamentos, com formulações práticas inspiradas em autores como Art Bennett, Laraine Bennett, Carolina Barros e Ítalo Marsili.</p>
  </div>

<script>
  const ENDPOINT = 'https://script.google.com/macros/s/AKfycbwtYYSkiPvMWNNnnaDeEdJN-5rsKVCPfDdP5Qu2JXRUu2BybNH1jFf0b92z609Fq1SM/exec';
  let ADMIN_KEY = 'DEFINA_UMA_CHAVE_SECRETA_FORTE'; // cole aqui a mesma chave definida no Apps Script (ou passe via URL ?key=SUA_CHAVE)
  (function(){ const k = new URLSearchParams(location.search).get('key'); if(k) ADMIN_KEY = k; })();

  const TEMPS = {
    SANG: { label: 'Sanguíneo', tone: 'tone-SANG' },
    COL:  { label: 'Colérico',  tone: 'tone-COL'  },
    MEL:  { label: 'Melancólico',tone: 'tone-MEL'  },
    FLEU: { label: 'Fleumático', tone: 'tone-FLEU' }
  };

  const INTERP = {
    SANG: 'Extrovertido, comunicativo, otimista, adaptável — pode ter dificuldade com foco e constância.',
    COL:  'Objetivo, determinado, competitivo e direto — pode ser impaciente e autoritário.',
    MEL:  'Detalhista, perfeccionista, analítico e organizado — pode ser excessivamente crítico.',
    FLEU: 'Calmo, estável, paciente e confiável — pode evitar mudanças e ser pouco proativo.'
  };

  const QUESTIONS = [
    { t:'SANG', text:'Gosto de conhecer novas pessoas e faço amizades facilmente.' },
    { t:'SANG', text:'Me sinto energizado quando estou em grupos ou eventos sociais.' },
    { t:'SANG', text:'Tenho facilidade em iniciar conversas com desconhecidos.' },
    { t:'SANG', text:'Sou entusiasmado e costumo animar os outros.' },
    { t:'SANG', text:'Tenho facilidade em expressar meus sentimentos e ideias.' },
    { t:'SANG', text:'Sou otimista, mesmo em situações desafiadoras.' },
    { t:'SANG', text:'Gosto de variar minhas atividades para evitar monotonia.' },
    { t:'SANG', text:'Costumo tomar decisões rapidamente quando estou empolgado.' },
    { t:'SANG', text:'Tenho facilidade em adaptar-me a novos ambientes.' },
    { t:'SANG', text:'Costumo falar bastante quando estou em um grupo.' },
    { t:'COL', text:'Gosto de assumir a liderança em projetos ou grupos.' },
    { t:'COL', text:'Tomo decisões de forma rápida e confiante.' },
    { t:'COL', text:'Busco resultados e não gosto de perder tempo.' },
    { t:'COL', text:'Sou competitivo e gosto de desafios.' },
    { t:'COL', text:'Consigo manter o foco mesmo sob pressão.' },
    { t:'COL', text:'Tenho facilidade em influenciar e motivar outras pessoas.' },
    { t:'COL', text:'Sou persistente e não desisto facilmente dos meus objetivos.' },
    { t:'COL', text:'Costumo resolver problemas de forma prática e direta.' },
    { t:'COL', text:'Tenho alta energia e ritmo acelerado no trabalho.' },
    { t:'COL', text:'Prefiro agir a ficar esperando por orientações.' },
    { t:'MEL', text:'Presto atenção aos detalhes antes de tomar decisões.' },
    { t:'MEL', text:'Sou organizado e planejo com antecedência.' },
    { t:'MEL', text:'Gosto que as coisas sejam feitas com perfeição.' },
    { t:'MEL', text:'Analiso prós e contras antes de agir.' },
    { t:'MEL', text:'Prefiro seguir regras e procedimentos estabelecidos.' },
    { t:'MEL', text:'Sou cuidadoso para evitar erros.' },
    { t:'MEL', text:'Prefiro ambientes estruturados e previsíveis.' },
    { t:'MEL', text:'Costumo revisar meu trabalho mais de uma vez.' },
    { t:'MEL', text:'Tenho facilidade em identificar problemas e inconsistências.' },
    { t:'MEL', text:'Gosto de trabalhar de forma minuciosa.' },
    { t:'FLEU', text:'Mantenho a calma mesmo em situações de estresse.' },
    { t:'FLEU', text:'Sou paciente com pessoas e processos.' },
    { t:'FLEU', text:'Prefiro evitar conflitos sempre que possível.' },
    { t:'FLEU', text:'Tenho facilidade em ouvir os outros com atenção.' },
    { t:'FLEU', text:'Sou leal e confiável em relacionamentos e no trabalho.' },
    { t:'FLEU', text:'Adapto-me bem a mudanças, mesmo que lentas.' },
    { t:'FLEU', text:'Sou consistente e mantenho um ritmo estável.' },
    { t:'FLEU', text:'Gosto de trabalhar em equipe de forma harmoniosa.' },
    { t:'FLEU', text:'Não me deixo levar facilmente por emoções fortes.' },
    { t:'FLEU', text:'Prefiro manter a estabilidade a arriscar mudanças bruscas.' }
  ];

  QUESTIONS.sort(() => Math.random() - 0.5);
  const answers = Array(QUESTIONS.length).fill(0);

  function renderQuestions(){
    const list = document.getElementById('qList');
    list.innerHTML = '';
    QUESTIONS.forEach((q, i) => {
      const li = document.createElement('li');
      li.className = 'q';
      li.innerHTML = `
        <div class="qhead">
          <div class="qtext">${i+1}. ${q.text}</div>
          <span class="pill">${TEMPS[q.t].label}</span>
        </div>
        <div class="likert" role="radiogroup" aria-label="Escala de 1 a 5">
          ${[1,2,3,4,5].map(n => `
            <div class="opt" data-q="${i}" data-v="${n}" tabindex="0">
              <b>${n}</b>
              <span>${n===1?'Nunca':n===2?'Raramente':n===3?'Às vezes':n===4?'Frequentemente':'Sempre'}</span>
            </div>
          `).join('')}
        </div>`;
      list.appendChild(li);
    });
  }

  function updateProgress(){
    const answered = answers.filter(v=>v>0).length;
    const pct = Math.round((answered/answers.length)*100);
    document.getElementById('pct').textContent = pct+"%";
    document.getElementById('bar').style.width = pct+"%";
  }

  function attachHandlers(){
    document.getElementById('qList').addEventListener('click', (e)=>{
      const el = e.target.closest('.opt');
      if(!el) return;
      const q = +el.dataset.q, v = +el.dataset.v;
      answers[q] = v;
      const group = el.parentElement.querySelectorAll('.opt');
      group.forEach(opt => opt.dataset.active = (opt===el? '1':'0'));
      updateProgress();
    });

    document.getElementById('qList').addEventListener('keydown', (e)=>{
      const el = e.target.closest('.opt');
      if(!el) return;
      if(e.key==='Enter' || e.key===' '){ e.preventDefault(); el.click(); }
    });

    document.getElementById('clear').addEventListener('click', ()=>{
      answers.fill(0);
      document.querySelectorAll('.opt').forEach(o=>o.dataset.active='0');
      updateProgress();
      document.getElementById('result').style.display='none';
      window.scrollTo({top:0,behavior:'smooth'});
    });

    document.getElementById('print').addEventListener('click', ()=> window.print());

    document.getElementById('see').addEventListener('click', ()=>{
      if(answers.some(a=>a===0)){
        alert('Por favor, responda todas as perguntas (1 a 5).');
        return;
      }
      showResults();
    });

    document.getElementById('save').addEventListener('click', async ()=>{
      if(answers.some(a=>a===0)){
        alert('Por favor, responda todas as perguntas (1 a 5).');
        return;
      }
      await submitResults();
    });
  }

  function calcScores(){
    const totals = {SANG:0,COL:0,MEL:0,FLEU:0};
    answers.forEach((v,i)=>{ totals[QUESTIONS[i].t]+=v; });
    return totals;
  }

  function showResults(){
    const scores = calcScores();
    const ranking = Object.entries(scores).sort((a,b)=>b[1]-a[1]);
    const maxPerTemp = 10*5;
    const dom = ranking[0][0], sec = ranking[1][0];
    const name = document.getElementById('candidate').value || 'Candidato';

    const box = document.getElementById('result');
    box.style.display='block';
    box.innerHTML = `
      <h2 style="margin:2px 0 10px;font-size:22px">Resultado</h2>
      <p class="small muted">${name ? 'Candidato: '+name : ''}</p>
      <div class="grid">
        ${Object.keys(TEMPS).map(k=>`
          <div>
            <div class="row" style="justify-content:space-between;font-size:14px;margin-bottom:6px">
              <b>${TEMPS[k].label}</b>
              <span style="font-family:ui-monospace,Menlo,Consolas">${scores[k]}/${maxPerTemp}</span>
            </div>
            <div class="bar"><i class="${TEMPS[k].tone}" style="width:${(scores[k]/maxPerTemp)*100}%"></i></div>
            <p class="small" style="margin:6px 0 0">${INTERP[k]}</p>
          </div>
        `).join('')}
      </div>

      <div class="card" style="padding:12px;margin-top:12px">
        <b>Síntese</b>
        <p class="small" style="margin:6px 0 0">Dominante: <b>${TEMPS[dom].label}</b> · Secundário: <b>${TEMPS[sec].label}</b></p>
        <p class="small muted" style="margin:6px 0 0">Em caso de empate, considere entrevistas situacionais para desempate.</p>
        <div class="actions" style="margin-top:8px">
          <button onclick="exportCSV()" class="primary">Exportar CSV</button>
          <button onclick="submitResults()">Enviar & Registrar</button>
        </div>
      </div>
    `;
    box.scrollIntoView({behavior:'smooth'});
  }

  function exportCSV(){
    const scores = calcScores();
    const ranking = Object.entries(scores).sort((a,b)=>b[1]-a[1]);
    const name = document.getElementById('candidate').value || 'Candidato';
    const headers = ['Candidato', ...QUESTIONS.map((_,i)=>`Q${i+1}`), 'Soma Sanguíneo','Soma Colérico','Soma Melancólico','Soma Fleumático','Dominante','Secundário'];
    const dom = TEMPS[ranking[0][0]].label;
    const sec = TEMPS[ranking[1][0]].label;
    const row = [name, ...answers, scores.SANG, scores.COL, scores.MEL, scores.FLEU, dom, sec];
    const csv = [headers.join(','), row.join(',')].join('\n');
    const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url; a.download = `resultado_teste_temperamentos_${name.replace(/\s+/g,'_').toLowerCase()}.csv`;
    document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
  }

  async function submitResults(){
    if(!ENDPOINT || ENDPOINT.length < 10){ alert('Configurar ENDPOINT antes de usar registro.'); return; }
    if(!ADMIN_KEY){ alert('Configurar ADMIN_KEY (ou passar ?key=...) antes de usar registro.'); return; }
    const scores = calcScores();
    const ranking = Object.entries(scores).sort((a,b)=>b[1]-a[1]);
    const name = document.getElementById('candidate').value || 'Candidato';
    const payload = {
      action: 'save',
      key: ADMIN_KEY,
      timestamp: new Date().toISOString(),
      candidate: name,
      answers: answers,
      sums: scores,
      dominant: TEMPS[ranking[0][0]].label,
      secondary: TEMPS[ranking[1][0]].label,
      ua: navigator.userAgent
    };
    try{
      const res = await fetch(ENDPOINT, { method:'POST', body: JSON.stringify(payload)});
      const data = await res.json().catch(()=>({ok:false}));
      if(res.ok && (data.ok!==false)){
        alert('Respostas registradas com sucesso.');
      } else {
        alert('Não foi possível registrar. Verifique a configuração do endpoint.');
      }
    }catch(err){
      alert('Erro de rede ao registrar: '+err);
    }
  }

  renderQuestions();
  attachHandlers();
  updateProgress();

  (function(){
    const params = new URLSearchParams(location.search);
    if(params.get('admin')==='1'){
      const quiz = document.getElementById('quiz'); if(quiz) quiz.style.display='none';
      const actions = document.querySelector('.actions'); if(actions) actions.style.display='none';
      const result = document.getElementById('result'); if(result) result.style.display='none';
      const adminBox = document.getElementById('admin');
      if(!adminBox) return;
      adminBox.style.display='block';
      adminBox.innerHTML = '<h2 style="margin:2px 0 10px;font-size:22px">Painel do Avaliador</h2><p class="small muted">Carregando registros...</p>';
      if(!ENDPOINT){ adminBox.innerHTML += '<p class="small" style="color:#b00">Configure o ENDPOINT para listar registros.</p>'; return; }
      fetch(ENDPOINT + '?action=list&key=' + encodeURIComponent(ADMIN_KEY))
        .then(r=>r.json())
        .then(rows=>{
          if(!Array.isArray(rows)) { adminBox.innerHTML = '<p class="small">Nenhum registro encontrado ou chave inválida.</p>'; return; }
          const headers = ['Data','Candidato','Dominante','Secundário','Soma SANG','Soma COL','Soma MEL','Soma FLEU'];
          const table = document.createElement('table');
          table.innerHTML = '<thead><tr>'+headers.map(h=>`<th>${h}</th>`).join('')+'</tr></thead>';
          const tbody = document.createElement('tbody');
          rows.forEach(r=>{
            const tr = document.createElement('tr');
            tr.innerHTML = [
              new Date(r.timestamp).toLocaleString(),
              r.candidate || '-',
              r.dominant || '-',
              r.secondary || '-',
              r.sums?.SANG ?? '-',
              r.sums?.COL ?? '-',
              r.sums?.MEL ?? '-',
              r.sums?.FLEU ?? '-'
            ].map(c=>`<td>${c}</td>`).join('');
            tbody.appendChild(tr);
          });
          table.appendChild(tbody);
          adminBox.innerHTML = '';
          adminBox.appendChild(table);

          const dl = document.createElement('button');
          dl.textContent = 'Baixar CSV';
          dl.className = 'primary';
          dl.style.marginTop = '10px';
          dl.onclick = () => {
            const csvRows = [headers.join(',')].concat(rows.map(r=>[
              new Date(r.timestamp).toISOString(),
              (r.candidate||'').replace(/,/g,' '),
              r.dominant||'', r.secondary||'',
              r.sums?.SANG??'', r.sums?.COL??'', r.sums?.MEL??'', r.sums?.FLEU??''
            ].join(',')));
            const blob = new Blob([csvRows.join('\n')], {type:'text/csv;charset=utf-8;'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a'); a.href = url; a.download = 'registros_teste_temperamentos.csv';
            document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
          };
          adminBox.appendChild(dl);
        })
        .catch(()=>{ adminBox.innerHTML = '<p class="small">Erro ao carregar registros.</p>'; });
    }
  })();
</script>
</body>
</html>
